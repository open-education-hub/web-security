"use strict";(self.webpackChunkweb_security=self.webpackChunkweb_security||[]).push([[825],{2146:(e,t,a)=>{a.d(t,{A:()=>i});const i=a.p+"assets/images/persistent-xss-7d8b685d86e847911b9bfba3caff5434.png"},2176:(e,t,a)=>{a.d(t,{A:()=>i});const i=a.p+"assets/images/server-client-xss-3daacf43c827bf4c99acd98b41e895a8.png"},4243:(e,t,a)=>{a.d(t,{A:()=>i});const i=a.p+"assets/images/self-xss-c6343af9c69fc17e46c3e135ab7e19bf.png"},5319:(e,t,a)=>{a.d(t,{A:()=>i});const i=a.p+"assets/images/reflected-xss-612e4f212ce0d814dbbbd9a3f231be50.png"},5680:(e,t,a)=>{a.d(t,{xA:()=>c,yg:()=>d});var i=a(6540);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,i)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach(function(t){n(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function o(e,t){if(null==e)return{};var a,i,n=function(e,t){if(null==e)return{};var a,i,n={},s=Object.keys(e);for(i=0;i<s.length;i++)a=s[i],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)a=s[i],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var l=i.createContext({}),p=function(e){var t=i.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},c=function(e){var t=p(e.components);return i.createElement(l.Provider,{value:t},e.children)},h="mdxType",g={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},u=i.forwardRef(function(e,t){var a=e.components,n=e.mdxType,s=e.originalType,l=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),h=p(a),u=n,d=h["".concat(l,".").concat(u)]||h[u]||g[u]||s;return a?i.createElement(d,r(r({ref:t},c),{},{components:a})):i.createElement(d,r({ref:t},c))});function d(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var s=a.length,r=new Array(s);r[0]=u;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o[h]="string"==typeof e?e:n,r[1]=o;for(var p=2;p<s;p++)r[p]=a[p];return i.createElement.apply(null,r)}return i.createElement.apply(null,a)}u.displayName="MDXCreateElement"},5700:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>g,frontMatter:()=>s,metadata:()=>o,toc:()=>p});var i=a(8168),n=(a(6540),a(5680));const s={},r="Cross-site Scripting (XSS)",o={unversionedId:"Web Application Security/Cross-Site Scripting/Reading/README",id:"Web Application Security/Cross-Site Scripting/Reading/README",title:"Cross-site Scripting (XSS)",description:"Intro",source:"@site/docs/Web Application Security/Cross-Site Scripting/Reading/README.md",sourceDirName:"Web Application Security/Cross-Site Scripting/Reading",slug:"/Web Application Security/Cross-Site Scripting/Reading/",permalink:"/web-security/Web Application Security/Cross-Site Scripting/Reading/",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"sidebar",previous:{title:"Reading",permalink:"/web-security/Web Application Security/Cross-Site Scripting/Reading/"},next:{title:"cross-site-scripting",permalink:"/web-security/Web Application Security/Cross-Site Scripting/cross-site-scripting"}},l={},p=[{value:"Intro",id:"intro",level:2},{value:"Impact",id:"impact",level:2},{value:"Types",id:"types",level:2},{value:"Reflected XSS",id:"reflected-xss",level:3},{value:"Example",id:"example",level:4},{value:"Stored XSS",id:"stored-xss",level:3},{value:"Example",id:"example-1",level:4},{value:"DOM XSS",id:"dom-xss",level:3},{value:"Example",id:"example-2",level:4},{value:"Note",id:"note",level:2},{value:"Defense Mechanisms",id:"defense-mechanisms",level:2},{value:"Other XSS",id:"other-xss",level:2},{value:"Self XSS",id:"self-xss",level:3},{value:"Mutated XSS",id:"mutated-xss",level:3},{value:"Challenges",id:"challenges",level:2},{value:"1. DVWA",id:"1-dvwa",level:3},{value:"2. XSS Challenges",id:"2-xss-challenges",level:3},{value:"3. Even more XSS Challenges",id:"3-even-more-xss-challenges",level:3},{value:"4. If you get here",id:"4-if-you-get-here",level:3},{value:"Further reading",id:"further-reading",level:2},{value:"Intro",id:"intro-1",level:2},{value:"Impact",id:"impact-1",level:2},{value:"How does it work?",id:"how-does-it-work",level:2},{value:"Prevention",id:"prevention",level:2},{value:"Note",id:"note-1",level:2},{value:"Challenges",id:"challenges-1",level:2},{value:"1. DVWA",id:"1-dvwa-1",level:3},{value:"2. PortSwigger Academy",id:"2-portswigger-academy",level:3},{value:"Further reading",id:"further-reading-1",level:2}],c={toc:p},h="wrapper";function g({components:e,...t}){return(0,n.yg)(h,(0,i.A)({},c,t,{components:e,mdxType:"MDXLayout"}),(0,n.yg)("h1",{id:"cross-site-scripting-xss"},"Cross-site Scripting (XSS)"),(0,n.yg)("h2",{id:"intro"},"Intro"),(0,n.yg)("p",null,"Cross-site Scripting (XSS) is a web security vulnerability that allows an attacker to inject malicious code, usually JavaScript, in the web browser of the victim. This implies that the attacker can do a lot of damage from stealing data to perform actions on behalf of the user. This type of vulnerability implies that the web application uses the user input in the HTML page that it serves. As opposed to other types of code injections, the malicious code in an XSS will always run on the client-side shifting the target from the server hosting the application to the users of the application."),(0,n.yg)("h2",{id:"impact"},"Impact"),(0,n.yg)("p",null,"The impact of the vulnerability is linked with the functionality that the web application provides. If the app is doesn't have much functionality (e.g. a news website) the attacker might not obtain much, but if it's a banking app, there is certainly something to obtain."),(0,n.yg)("p",null,"Cross-site Scripting can be used to achieve a lot of things:"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"steal data - sensitive data as login credentials or credit card numbers"),(0,n.yg)("li",{parentName:"ul"},"hijack the session of the user - get the user's session token and browse the application as it's your account without any credentials"),(0,n.yg)("li",{parentName:"ul"},"track user movements - keylogging, taking screenshots of the page"),(0,n.yg)("li",{parentName:"ul"},"perform actions on behalf of the user - sending payments to attacker's account"),(0,n.yg)("li",{parentName:"ul"},"alter the looks of the HTML page (virtual defacement) - fake the balance of the account while the attacker steals the money"),(0,n.yg)("li",{parentName:"ul"},"mining - placing a cryptocurrency miner in the page while the user reads a long article"),(0,n.yg)("li",{parentName:"ul"},"if that's not enough, you may find more ideas ",(0,n.yg)("a",{parentName:"li",href:"http://www.xss-payloads.com/payloads.html"},"here"),".")),(0,n.yg)("h2",{id:"types"},"Types"),(0,n.yg)("p",null,"There are mainly three types of XSS:"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Reflected XSS"),(0,n.yg)("li",{parentName:"ul"},"Stored XSS"),(0,n.yg)("li",{parentName:"ul"},"DOM XSS")),(0,n.yg)("h3",{id:"reflected-xss"},"Reflected XSS"),(0,n.yg)("p",null,"Reflected XSS or non-persistent is the simplest form of XSS and occurs when user input is immediately returned by the web application in the HTTP response."),(0,n.yg)("p",null,(0,n.yg)("img",{alt:"Reflected XSS Steps",src:a(5319).A,width:"848",height:"420"})),(0,n.yg)("p",null,(0,n.yg)("img",{alt:"Reflected XSS steps",src:a(8074).A,width:"571",height:"251"})),(0,n.yg)("ol",null,(0,n.yg)("li",{parentName:"ol"},"The attacker crafts a URL containing a malicious string and sends it to the victim."),(0,n.yg)("li",{parentName:"ol"},"The victim is tricked by the attacker into requesting the URL from the website."),(0,n.yg)("li",{parentName:"ol"},"The website includes the malicious string from the URL in the response."),(0,n.yg)("li",{parentName:"ol"},"The victim's browser executes the malicious script inside the response, sending the victim's cookies to the attacker's server.")),(0,n.yg)("h4",{id:"example"},"Example"),(0,n.yg)("p",null,"Let's consider a simple application that greets the user with the name passed through the parameter ",(0,n.yg)("inlineCode",{parentName:"p"},"name")," in the URL.\n",(0,n.yg)("inlineCode",{parentName:"p"},"https://example.com/greet?name=John")),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-html"},"<p>Hello John!</p>\n")),(0,n.yg)("p",null,"Without changing the user input in any way, an attacker might give the following input:"),(0,n.yg)("p",null,(0,n.yg)("inlineCode",{parentName:"p"},"https://example.com/greet?name=<script>alert(1)<\/script>")),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-html"},"<p>Hello <script>alert(1)<\/script>!</p>\n")),(0,n.yg)("p",null,"The attacker now has control to the JavaScript code using a parameter stored in the URL."),(0,n.yg)("h3",{id:"stored-xss"},"Stored XSS"),(0,n.yg)("p",null,"Stored XSS or persistent XSS happens when user input is stored in the database and it is used non-sanitized in the response HTML pages."),(0,n.yg)("p",null,(0,n.yg)("img",{alt:"Persistent XSS Steps",src:a(2146).A,width:"804",height:"456"})),(0,n.yg)("p",null,(0,n.yg)("img",{alt:"Stored XXS Steps",src:a(6463).A,width:"561",height:"411"})),(0,n.yg)("ol",null,(0,n.yg)("li",{parentName:"ol"},"The attacker uses one of the website's forms to insert a malicious string into the website's database."),(0,n.yg)("li",{parentName:"ol"},"The victim requests a page from the website."),(0,n.yg)("li",{parentName:"ol"},"The website includes the malicious string from the database in the response and sends it to the victim."),(0,n.yg)("li",{parentName:"ol"},"The victim's browser executes the malicious script inside the response, sending the victim's cookies to the attacker's server.")),(0,n.yg)("h4",{id:"example-1"},"Example"),(0,n.yg)("p",null,"A simple example would be an online shop with a review system that would let customers to write text/comments about the products.\nOne might use it to say ",(0,n.yg)("inlineCode",{parentName:"p"},'"This product is great! I recommend it!"')),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-html"},"<p>This product is great! I recommend it!</p>\n")),(0,n.yg)("p",null,"But an attacker might use it to send ",(0,n.yg)("inlineCode",{parentName:"p"},'"<script>alert(1)<\/script>"')),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-html"},"<p><script>alert(1)<\/script></p>\n")),(0,n.yg)("p",null,"The difference between this example and the one at Reflected XSS is that the attacker uses a request to send the review that will be stored in the database of the server. Later on, when another user accesses the product page, the code behind the website will get from the database all reviews associated with the product and insert them in the HTML response page."),(0,n.yg)("h3",{id:"dom-xss"},"DOM XSS"),(0,n.yg)("p",null,"DOM vulnerabilities usually arise when JavaScript code uses data from the user to construct the DOM / HTML page."),(0,n.yg)("p",null,(0,n.yg)("img",{alt:"DOM XSS Steps",src:a(6093).A,width:"902",height:"576"}),"\n",(0,n.yg)("img",{alt:"XSS DOM Steps",src:a(9314).A,width:"551",height:"371"})),(0,n.yg)("ol",null,(0,n.yg)("li",{parentName:"ol"},"The attacker crafts a URL containing a malicious string and sends it to the victim."),(0,n.yg)("li",{parentName:"ol"},"The victim is tricked by the attacker into requesting the URL from the website."),(0,n.yg)("li",{parentName:"ol"},"The website receives the request, but does not include the malicious string in the response."),(0,n.yg)("li",{parentName:"ol"},"The victim's browser executes the legitimate script inside the response, causing the malicious script to be inserted into the page."),(0,n.yg)("li",{parentName:"ol"},"The victim's browser executes the malicious script inserted into the page, sending the victim's cookies to the attacker's server.")),(0,n.yg)("h4",{id:"example-2"},"Example"),(0,n.yg)("p",null,"Suppose the following code is used to create a form to let the user choose his/her preferred language. A default language is also provided in the query string, as the parameter \u201cdefault\u201d."),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-html"},'Select your language:\n\n<select><script>\n\ndocument.write("<OPTION value=1>"+document.location.href.substring(document.location.href.indexOf("default=")+8)+"</OPTION>");\n\ndocument.write("<OPTION value=2>English</OPTION>");\n\n<\/script></select>\n')),(0,n.yg)("p",null,"The page is invoked with a URL such as:"),(0,n.yg)("p",null,(0,n.yg)("inlineCode",{parentName:"p"},"https://example.com/page.html?default=French")),(0,n.yg)("p",null,"A DOM Based XSS attack against this page can be accomplished by sending the following URL to a victim:"),(0,n.yg)("p",null,(0,n.yg)("inlineCode",{parentName:"p"},"https://example.com/page.html?default=<script>alert(1)<\/script>")),(0,n.yg)("h2",{id:"note"},"Note"),(0,n.yg)("p",null,"The three types of XSS presented above are the ones that historically speaking were categorised, but in order to do a categorization a criteria is needed. The types above have no criteria on which they are sepparated, so let's split XSS vulnerabilities by the place where data is used:"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Server XSS"),(0,n.yg)("li",{parentName:"ul"},"Client XSS")),(0,n.yg)("p",null,"By doing so, the three types above mentioned will look like this:\n",(0,n.yg)("img",{alt:"Server vs Client XSS",src:a(2176).A,width:"914",height:"684"})),(0,n.yg)("h2",{id:"defense-mechanisms"},"Defense Mechanisms"),(0,n.yg)("ol",null,(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},"Filter input on arrival.")," At the point where user input is received, filter as strictly as possible based on what is expected or valid input."),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},"Encode data on output.")," At the point where user-controllable data is output in HTTP responses, encode the output to prevent it from being interpreted as active content. Depending on the output context, this might require applying combinations of HTML, URL, JavaScript, and CSS encoding."),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},"Use appropriate response headers.")," To prevent XSS in HTTP responses that aren't intended to contain any HTML or JavaScript, you can use the ",(0,n.yg)("inlineCode",{parentName:"li"},"Content-Type")," and ",(0,n.yg)("inlineCode",{parentName:"li"},"X-Content-Type-Options")," headers to ensure that browsers interpret the responses in the way you intend."),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},"Content Security Policy.")," Use Content Security Policy (CSP) to reduce the severity of any XSS vulnerabilities that still occur."),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("strong",{parentName:"li"},"Continuous database scanning.")," For stored XSS is common practice to scan the database at regulated intervals, although XSS payloads can be written in multiple formats (base64, binary etc.).")),(0,n.yg)("h2",{id:"other-xss"},"Other XSS"),(0,n.yg)("h3",{id:"self-xss"},"Self XSS"),(0,n.yg)("p",null,"Self XSS is a social engineering attack used to gain access to victim's web accounts. The victim is tricked into running malicious JavaScript code into their own browser, in web developer console, which can either exfiltrate data or perform actions on behalf of the user.\nThis is not a code injection vulnerability as each website is vulnerable to this type of attack. In order to prevent this, websites add warning messages in console. In the image below, there are two examples, from Google Meet and Facebook."),(0,n.yg)("p",null,(0,n.yg)("img",{alt:"Self XSS",src:a(4243).A,width:"695",height:"423"})),(0,n.yg)("h3",{id:"mutated-xss"},"Mutated XSS"),(0,n.yg)("p",null,"Mutated XSS happens when the browser tries to fix and rewrite invaild HTML but fails doing so thus executing attacker's code. Because it depends from browser to browser, is extremely hard to detect or sanitize within the websites application logic. At the end of this page you will find a video explaining a mXSS on Google Search, and also check the link for one of the first papers describing mXSS attacks."),(0,n.yg)("h2",{id:"challenges"},"Challenges"),(0,n.yg)("h3",{id:"1-dvwa"},"1. DVWA"),(0,n.yg)("p",null,"We will use Damn Vulnerable Web Application (DVWA) for this one. You may install it however you want, just to work, but a simple way to do it is by using Docker. Once you ",(0,n.yg)("a",{parentName:"p",href:"https://docs.docker.com/engine/install/"},"installed")," docker you must run"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-bash"},"$ docker run --rm -it -p 8080:80 vulnerables/web-dvwa\n")),(0,n.yg)("p",null,"To access the app, go to http://localhost:8080/setup.php and click on ",(0,n.yg)("inlineCode",{parentName:"p"},"Create/Reset Database"),". Login with username ",(0,n.yg)("inlineCode",{parentName:"p"},"admin")," and password ",(0,n.yg)("inlineCode",{parentName:"p"},"password"),"."),(0,n.yg)("p",null,"DVWA has multipe vulnerable components, but today we will use the XSS related ones. The app has 4 levels of security that can be changed from 'DVWA Security' section.\nAll the DVWA challenges allow you to view the PHP source of the page to get additional info about the back-end script. However, in a real-world scenario you won't have that kind of access, so please use this functionality only after you have finished the challenge."),(0,n.yg)("p",null,"The goal of this challenges is to rise an ",(0,n.yg)("inlineCode",{parentName:"p"},"alert(1)")," from JavaScript like this:\n",(0,n.yg)("img",{alt:"DVWA Alert 1",src:a(8605).A,width:"899",height:"582"})),(0,n.yg)("p",null,"With the security level set on ",(0,n.yg)("strong",{parentName:"p"},"low")," you will have to go through each XSS type. Raise the alert, then change the security level to ",(0,n.yg)("strong",{parentName:"p"},"medium")," and then ",(0,n.yg)("strong",{parentName:"p"},"high"),". After you are done with this, change on ",(0,n.yg)("strong",{parentName:"p"},"impossible")," and click on ",(0,n.yg)("inlineCode",{parentName:"p"},"View Source"),". Why an exploit is not possible in this case? Check the PHP documentation to understand why."),(0,n.yg)("p",null,"Go thgough each on in the following order: Reflected, Stored, DOM"),(0,n.yg)("h3",{id:"2-xss-challenges"},"2. XSS Challenges"),(0,n.yg)("p",null,"You have 6 levels to finish here: ",(0,n.yg)("a",{parentName:"p",href:"https://xss-game.appspot.com/"},"https://xss-game.appspot.com/")),(0,n.yg)("h3",{id:"3-even-more-xss-challenges"},"3. Even more XSS Challenges"),(0,n.yg)("p",null,(0,n.yg)("a",{parentName:"p",href:"https://alf.nu/alert1"},"https://alf.nu/alert1")),(0,n.yg)("h3",{id:"4-if-you-get-here"},"4. If you get here"),(0,n.yg)("p",null,(0,n.yg)("a",{parentName:"p",href:"http://prompt.ml/0"},"http://prompt.ml/0")),(0,n.yg)("p",null,(0,n.yg)("a",{parentName:"p",href:"https://xss-quiz.int21h.jp/"},"https://xss-quiz.int21h.jp/")),(0,n.yg)("p",null,(0,n.yg)("a",{parentName:"p",href:"http://sudo.co.il/xss/"},"http://sudo.co.il/xss/")),(0,n.yg)("p",null,"Those should be enough to suck the soul out of you."),(0,n.yg)("h2",{id:"further-reading"},"Further reading"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("a",{parentName:"li",href:"https://owasp.org/www-community/attacks/xss/"},"https://owasp.org/www-community/attacks/xss/")),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("a",{parentName:"li",href:"https://portswigger.net/web-security/cross-site-scripting"},"https://portswigger.net/web-security/cross-site-scripting")),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("a",{parentName:"li",href:"https://pentest-tools.com/blog/xss-attacks-practical-scenarios/"},"5 Practical Scenarios for XSS Attacks")),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("a",{parentName:"li",href:"http://www.xss-payloads.com/payloads.html"},"XSS Exploit Payloads")),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("a",{parentName:"li",href:"https://portswigger.net/web-security/cross-site-scripting/cheat-sheet"},"XSS Cheat Sheet 1")),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("a",{parentName:"li",href:"https://owasp.org/www-community/xss-filter-evasion-cheatsheet"},"XSS Cheat Sheet 2")),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("a",{parentName:"li",href:"https://www.youtube.com/watch?v=lG7U3fuNw3A"},"Mutated XSS on Google Search")),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("a",{parentName:"li",href:"https://cure53.de/fp170.pdf"},"mXSS paper"))),(0,n.yg)("hr",null),(0,n.yg)("h1",{id:"cross-site-request-forgery-csrf"},"Cross-Site Request Forgery (CSRF)"),(0,n.yg)("h2",{id:"intro-1"},"Intro"),(0,n.yg)("p",null,"Cross-site request forgery is a vulnerability in web applications that allows an attacker to trick users into performing actions that they did not intend."),(0,n.yg)("h2",{id:"impact-1"},"Impact"),(0,n.yg)("p",null,"Once again, the impact of the vulnerability is linked with the functionality that the web application provides, but it can range from posting a comment on behalf of the user with an outdated 2008 meme to making payments to attacker's wallet to full account takeover."),(0,n.yg)("h2",{id:"how-does-it-work"},"How does it work?"),(0,n.yg)("p",null,"For a CSRF attack to be possible, three key conditions must be in place:"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"A relevant action.")," There is an action within the application that the attacker has a reason to induce. This might be a privileged action (such as modifying permissions for other users) or any action on user-specific data (such as changing the user's own password)."),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"Cookie-based session handling.")," Performing the action involves issuing one or more HTTP requests, and the application relies solely on session cookies to identify the user who has made the requests. There is no other mechanism in place for tracking sessions or validating user requests."),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"No unpredictable request parameters.")," The requests that perform the action do not contain any parameters whose values the attacker cannot determine or guess. For example, when causing a user to change their password, the function is not vulnerable if an attacker needs to know the value of the existing password.")),(0,n.yg)("p",null,"For example, suppose an application contains a function that lets the user change the email address on their account. When a user performs this action, they make an HTTP request like the following:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre"},"POST /email/change HTTP/1.1\nHost: vulnerable-website.com\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 30\nCookie: session=yvthwsztyeQkAPzeQ5gHgTvlyxHfsAfE\n\nemail=wiener@normal-user.com\n")),(0,n.yg)("p",null,"This meets the conditions required for CSRF:"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"The action of changing the email address on a user's account is of interest to an attacker. Following this action, the attacker will typically be able to trigger a password reset and take full control of the user's account."),(0,n.yg)("li",{parentName:"ul"},"The application uses a session cookie to identify which user issued the request. There are no other tokens or mechanisms in place to track user sessions."),(0,n.yg)("li",{parentName:"ul"},"The attacker can easily determine the values of the request parameters that are needed to perform the action.")),(0,n.yg)("p",null,"With these conditions in place, the attacker can construct a web page containing the following HTML:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-html"},'<html>\n  <body>\n    <form action="https://vulnerable-website.com/email/change" method="POST">\n      <input type="hidden" name="email" value="pwned@evil-user.net" />\n    </form>\n    <script>\n      document.forms[0].submit();\n    <\/script>\n  </body>\n</html>\n')),(0,n.yg)("h2",{id:"prevention"},"Prevention"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Use SameSite cookie attribute (similar to HTTPOnly and Secure)"),(0,n.yg)("li",{parentName:"ul"},"Add a CSRF token for each request that changes the state of the application (e.g. changing password, sending messages) and validate it on backend"),(0,n.yg)("li",{parentName:"ul"},"Use user interaction based CSRF defense for sensitive actions such as changing credentials: re-authentication, one-time token, captcha"),(0,n.yg)("li",{parentName:"ul"},"Use Cross-origin resource sharing (CORS) headers to prevent CSRF from your website"),(0,n.yg)("li",{parentName:"ul"},"GET methods should not change the state of the application. Use appropriate HTTP methods for their intention."),(0,n.yg)("li",{parentName:"ul"},"in-depth list ",(0,n.yg)("a",{parentName:"li",href:"https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html"},"here"))),(0,n.yg)("p",null,"If you find an action/request to have a CSRF token don't give up to that so easily, there are a number of ways that improper validation of the token will still result in a CSRF vulnerability:"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Validation of CSRF token depends on request method"),(0,n.yg)("li",{parentName:"ul"},"Validation of CSRF token depends on token being present"),(0,n.yg)("li",{parentName:"ul"},"CSRF token is not tied to the user session"),(0,n.yg)("li",{parentName:"ul"},"CSRF token is tied to a non-session cookie"),(0,n.yg)("li",{parentName:"ul"},"CSRF token is simply duplicated in a cookie")),(0,n.yg)("h2",{id:"note-1"},"Note"),(0,n.yg)("p",null,"You can combine XSS with CSRF :). If you have two websites that share a part of their user base, you can use a XSS vulnerability in one to abuse a CSRF vulnerability in the other one. For example if a company provides two related services (e.g. email and calendar) you can assume that there is a high probability that a user might have accounts on both of the services, making a Stored XSS in one app a great way to exploit a CSRF in the other one."),(0,n.yg)("h2",{id:"challenges-1"},"Challenges"),(0,n.yg)("h3",{id:"1-dvwa-1"},"1. DVWA"),(0,n.yg)("p",null,"Using the same setup as for XSS challenges, go to the CSRF page of DVWA and craft URLs that will change the password for the user accessing it for each security level: ",(0,n.yg)("strong",{parentName:"p"},"low"),", ",(0,n.yg)("strong",{parentName:"p"},"medium"),", ",(0,n.yg)("strong",{parentName:"p"},"hard"),". Why a CSRF is not possible for ",(0,n.yg)("strong",{parentName:"p"},"impossible"),"?"),(0,n.yg)("h3",{id:"2-portswigger-academy"},"2. PortSwigger Academy"),(0,n.yg)("p",null,"You have 8 challenges here: ",(0,n.yg)("a",{parentName:"p",href:"https://portswigger.net/web-security/all-labs#cross-site-request-forgery-csrf"},"https://portswigger.net/web-security/all-labs#cross-site-request-forgery-csrf")),(0,n.yg)("h2",{id:"further-reading-1"},"Further reading"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("a",{parentName:"li",href:"https://portswigger.net/web-security/csrf"},"https://portswigger.net/web-security/csrf")),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("a",{parentName:"li",href:"https://owasp.org/www-community/attacks/csrf"},"https://owasp.org/www-community/attacks/csrf")),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("a",{parentName:"li",href:"https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html"},"CSRF Prevention Cheat Sheet"))))}g.isMDXComponent=!0},6093:(e,t,a)=>{a.d(t,{A:()=>i});const i=a.p+"assets/images/dom-based-xss-26e3f1543764658d7f8453d9a4ab6b1a.png"},6463:(e,t,a)=>{a.d(t,{A:()=>i});const i=a.p+"assets/images/XSS_stored-f7b0fb13610b052ec9634af5ed878212.gif"},8074:(e,t,a)=>{a.d(t,{A:()=>i});const i=a.p+"assets/images/XSS_reflected-19fe47ec709c1a579bcb8466503d961f.gif"},8605:(e,t,a)=>{a.d(t,{A:()=>i});const i=a.p+"assets/images/dvwa-alert-1-92d3e951d80b485e6898fe604b9df479.png"},9314:(e,t,a)=>{a.d(t,{A:()=>i});const i=a.p+"assets/images/XSS_dom-16a8185ed3a985685ab395ca8284a0fa.gif"}}]);